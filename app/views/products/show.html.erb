<div class="container mt-4">
  <!-- Breadcrumbs -->
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><%= link_to "Home", root_path %></li>
      <li class="breadcrumb-item"><%= link_to @product.category.name, products_path(category_id: @product.category.id) %></li>
      <li class="breadcrumb-item active" aria-current="page"><%= @product.name %></li>
    </ol>
  </nav>

  <div class="row">
    <!-- Product Image -->
    <div class="col-md-6">
      <% if @product.image.attached? %>
        <%= image_tag @product.image, class: "img-fluid rounded", alt: @product.name %>
      <% else %>
        <div class="bg-light rounded d-flex align-items-center justify-content-center" style="height: 400px;">
          <span class="text-muted fs-3">No image available</span>
        </div>
      <% end %>
    </div>

    <!-- Product Details -->
    <div class="col-md-6">
      <h1><%= @product.name %></h1>

      <!-- Badges -->
      <div class="mb-3">
        <% if @product.on_sale %>
          <span class="badge bg-success fs-6">On Sale</span>
        <% end %>
        <% if @product.new_arrival %>
          <span class="badge bg-info fs-6">New Arrival</span>
        <% end %>
      </div>

      <!-- Price -->
      <h2 class="text-primary mb-3">$<%= number_with_precision(@product.price, precision: 2) %></h2>

      <!-- Description -->
      <div class="mb-4">
        <h5>Description</h5>
        <p><%= @product.description %></p>
      </div>

      <!-- Category -->
      <div class="mb-4">
        <h6>Category:</h6>
        <%= link_to @product.category.name, products_path(category_id: @product.category.id), class: "btn btn-outline-secondary btn-sm" %>
      </div>

      <!-- Stock Status -->
      <div class="mb-4">
        <% if @product.stock > 0 %>
          <span class="badge bg-success">In Stock (<%= @product.stock %> available)</span>
        <% else %>
          <span class="badge bg-danger">Out of Stock</span>
        <% end %>
      </div>

      <!-- Add to Cart (will implement later) -->
      <% if @product.stock > 0 %>
        <div class="d-grid gap-2">
          <button class="btn btn-primary btn-lg" disabled>Add to Cart (Coming Soon)</button>
        </div>
      <% else %>
        <button class="btn btn-secondary btn-lg" disabled>Out of Stock</button>
      <% end %>

      <!-- Back to Products -->
      <div class="mt-3">
        <%= link_to "â† Back to Products", products_path, class: "btn btn-outline-secondary" %>
      </div>
    </div>
  </div>

  <!-- Related Products Section -->
  <div class="mt-5">
    <h3>More from <%= @product.category.name %></h3>
    <hr>
    <div class="row">
      <% @product.category.products.where.not(id: @product.id).limit(4).each do |related_product| %>
        <div class="col-md-3 mb-4">
          <div class="card h-100">
            <% if related_product.image.attached? %>
              <%= link_to product_path(related_product) do %>
                <%= image_tag related_product.image, class: "card-img-top", style: "height: 150px; object-fit: cover;" %>
              <% end %>
            <% else %>
              <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 150px;">
                <span class="text-muted small">No image</span>
              </div>
            <% end %>

            <div class="card-body">
              <h6 class="card-title"><%= truncate(related_product.name, length: 40) %></h6>
              <p class="text-primary fw-bold">$<%= number_with_precision(related_product.price, precision: 2) %></p>
              <%= link_to "View", product_path(related_product), class: "btn btn-sm btn-outline-primary" %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>